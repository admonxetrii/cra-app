{% extends 'base/base.html' %}
{% block 'title' %} Tables {% endblock %}
{% load static %}
{% block 'script' %}
{% endblock %}
{% block 'body' %}
    <div class="container-fluid">
    {% include 'component/message.html' %}
    <div class="d-sm-flex justify-content-between align-items-center mb-4">
        <h1 class="text-dark font-weight-bold mb-0">Tables</h1>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="row text-center">
                <div class="col-md-3">
                    <div class="text-dark font-weight-bold h3 mb-0">Total Tables <br> <span id="ttbl"
                                                                                            style="color: #2e59d9"></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-dark font-weight-bold h3 mb-0">Available Tables <br> <span id="atbl"
                                                                                                style="color: #1cc88a"></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-dark font-weight-bold h3 mb-0">Occupied Tables <br><span id="otbl"
                                                                                              style="color: #e74a3b"></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-dark font-weight-bold h3 mb-0">Today's RSVP <br> <span id="rtbl"
                                                                                            class="text-warning"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <p><br><br></p>
    <hr>
    <p><br><br></p>
    <script>
        var ttbl = 0;
        var atbl = 0;
        var otbl = 0;
        var rtbl = 0;
    </script>
    {% for f in floor %}
        <div class="text-dark font-weight-bold h3 col-md-3 col-xl-2 mb-2">
            {{ f.floorName }} <br>
        </div>
        <div class="row">
        {% for t in table %}
            {% if t.floorLevel.id == f.id %}
                <script> ttbl = ttbl + 1;</script>
                <div class="col-md-3 col-xl-2 mb-2">
                {% if t.isOccupied == 1 %}
                    <script>otbl = otbl + 1;</script>
                    <div class="card">
                    <div class="card-header bg-danger">
                        <h4 class="m-b-0 text-white"></h4></div>
                {% else %}
                    <script>atbl += 1;</script>
                    <div class="card border-success">
                    <div class="card-header bg-success">
                        <h4 class="m-b-0 text-white"></h4></div>
                {% endif %}
            <div class="card-body">
                <div class="row align-items-center no-gutters">
                    <div class="col mr-2">
                        {#                        <!--                            <div class="text-uppercase text-primary font-weight-bold text-xs mb-1"><span>{{i.title}}</span></div>-->#}
                        <a href="#" class="col-md-6 col-xl-3 mb-4" data-toggle="modal"
                           data-target="#reservations{{ t.id }}">
                            {#                                                            <a href="{% url 'tableorder' t.id %}" class="col-md-6 col-xl-3 mb-4" >#}
                            <div class="text-dark font-weight-bold h2 mb-0">
                                <span>{{ t.tableName }} </span>
                            </div>
                        </a>
                        <script>var rsvp = 0;</script>
                        {% for r in rsvp %}
                            {% if r.table.id == t.id %}
                                <script>rtbl += 1;</script>
                                {% if not r.success %}
                                    <script>rsvp++;</script>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% if t.isOccupied == 1 %}
                        {% for r in rsvp %}
                            {% if r.table.id and r.success and not r.tableReleased %}
                                <a class="btn btn-outline-danger btn-sm"
                                   onclick="confirm('Are you sure want to release??')"
                                   href="{% url 'release-reservation' r.id %}"><i
                                        class="fa fa-check-circle"></i> Release
                                </a>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <span id="#rsvp{{ t.id }}" class="text-muted"></span>
                        <script>
                            if (rsvp > 0) {
                                document.getElementById('#rsvp{{ t.id }}').innerHTML = `${rsvp} Reservations available.`;
                            }
                        </script>
                    {% endif %}
                </div>
            </div>
            </div>
            </div>
            {% endif %}
        {% endfor %}

    {#{% for mt in merge %}#}
    {#    <script>otbl=otbl+2;</script>#}
    {#    <div class="col-md-3 col-xl-2 ">#}
    {##}
    {#            <div class="card">#}
    {#                <div class="card-header bg-danger">#}
    {#                    <h4 class="m-b-0 text-white"></h4></div>#}
    {#                <div class="card-body" >#}
    {#                    <div class="row align-items-center no-gutters">#}
    {#                        <div class="col mr-2">#}
    {#<!--                            <div class="text-uppercase text-primary font-weight-bold text-xs mb-1"><span>{{i.title}}</span></div>-->#}
    {#                            <a href="{% url 'tableorder' mt.table1.id %}" class="col-md-6 col-xl-3 mb-4" >#}
    {#                                 <div class="text-dark font-weight-bold h2 mb-0"><span>{{mt.table1.title}}, {{mt.table2.title}} </span></div>#}
    {#                            </a>#}
    {#                        </div>#}
    {#                        <div class=" h6 mb-0">#}
    {#                            <a href="{% url 'unmerge_table' mt.id %}"><button class="btn btn-info btn-sm" onclick="return confirm('Are you sure?')"><i class="fa fa-edit"></i> Unmerge</button></a>#}
    {#                        </div>#}
    {#                    </div>#}
    {#                </div>#}
    {#            </div>#}
    {##}
    {#    </div>#}
    {#{% endfor %}#}
    <script>
        document.getElementById('ttbl').innerHTML = ttbl;
        document.getElementById('otbl').innerHTML = otbl;
        document.getElementById('atbl').innerHTML = atbl;
        document.getElementById('rtbl').innerHTML = rtbl;
    </script>
    {% if request.user.is_superuser %}
        <div class="col-md-3 col-xl-2 mb-2">
            <div class="card shadow border-left-info py-2">
                <div class="card-body" data-toggle="modal" data-target="#addTable">
                    <div class="row align-items-center no-gutters">
                        <div class="col mr-2">
                            <a href="#" class="col-md-6 col-xl-3 mb-4">
                                <div class="text-dark font-weight-bold h3 mb-0">
                                    <span><i class="fa fa-table"></i> Add Table</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    </div>
    {% endfor %}
</div>
    <hr>
    <div class="container-fluid">

    </div>

    <!--model for changing table-->
    {% for t in table %}
        <div class="modal fade" id="reservations{{ t.id }}" tabindex="-1" role="dialog"
             aria-labelledby="exampleModalCenterTitle"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle">Reservations for <b
                                class="text-danger">{{ t.tableName }}</b></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive m-t-40">
                            <table id="myTable2" class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th>Pax</th>
                                    <th>Time</th>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for r in rsvp %}
                                    {% if r.table.id == t.id %}
                                        {% if not r.success  %}
                                            <tr>
                                                <td>{{ r.groupSize }}</td>
                                                <td class="align-middle" width="30%">
                                                <span
                                                        class="font-weight-bold">{{ r.startDate|date:"h:i A" }}</span>
                                                    to
                                                    <span class="font-weight-bold">{{ r.endDate|date:"h:i A" }}</span>
                                                </td>
                                                <td class="align-middle">{{ r.user.first_name }} {{ r.user.last_name }}</td>
                                                <td class="align-middle">{{ r.user.phone_number }}</td>
                                                {% if current_time < r.startDate %}
                                                    <td class="align-middle">Not time yet</a>
                                                    </td>
                                                {% else %}
                                                    <td class="align-middle"><a
                                                            class="btn btn-sm btn-rounded btn-outline-danger"
                                                            href="{% url 'accept-reservation' r.id %}"
                                                            onclick="confirm('Are you sure want to accept this reservation?')">Accept</a>
                                                    </td>
                                                {% endif %}
                                            </tr>
                                        {% else %}
                                            <tr>
                                                <h3 class="text-danger font-weight-bold" id="#notFound{{ t.id }}"></h3>
                                            </tr>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                                <script>
                                    document.getElementById('#notFound{{ t.id }}').innerHTML = "No Reservations for today!!"
                                </script>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    {% endfor %}

    <!--model for add table-->

    <div class="modal fade" id="addTable" tabindex="-1" role="dialog" aria-labelledby="mergeTable"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Add New <b class="text-danger">Table</b></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" action="#" novalidate>
                        {#                <form method="post" action="{% url 'addTables' %}" novalidate>#}
                        <div class="form-group">
                            <h5>Enter Title: <span class="text-danger">*</span></h5>
                            <div class="controls">
                                <input type="text" id="title" name="title" required
                                       data-validation-required-message="This field is required" class="form-control">
                            </div>
                        </div>
                        {% csrf_token %}
                        <button class="btn btn-info btn-block" type="submit"><i class="fa fa-plus"></i> Add Table
                        </button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!--model for edit table-->

    {% for t in table %}

        <div class="modal fade" id="editTable{{ t.id }}" tabindex="-1" role="dialog" aria-labelledby="mergeTable"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle">Edit Table - <b
                                class="text-danger">{{ t.title }}</b></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form method="post" action="#" novalidate>
                            {#                <form method="post" action="{% url 'editTable' t.id %}" novalidate>#}
                            <div class="form-group">
                                <h5>Enter New Title: <span class="text-danger">*</span></h5>
                                <div class="controls">
                                    <input type="text" id="title" name="newtitle" value="{{ t.title }}" required
                                           data-validation-required-message="This field is required"
                                           class="form-control">
                                </div>
                            </div>
                            {% csrf_token %}
                            <button class="btn btn-info btn-block" type="submit"><i class="fa fa-edit"></i> Edit Table
                            </button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

    <!--model for merge table-->
    {##}
    {#<div class="modal fade" id="merge" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"#}
    {#     aria-hidden="true">#}
    {#    <div class="modal-dialog modal-dialog-centered" role="document">#}
    {#        <div class="modal-content">#}
    {#            <div class="modal-header">#}
    {#                <h5 class="modal-title" id="exampleModalLongTitle">Merge <b class="text-danger">Tables</b></h5>#}
    {#                <button type="button" class="close" data-dismiss="modal" aria-label="Close">#}
    {#                    <span aria-hidden="true">&times;</span>#}
    {#                </button>#}
    {#            </div>#}
    {#            <div class="modal-body">#}
    {#                <form method="post" action="{% url 'merge_table' %}" >#}
    {#                    <div class="form-group">#}
    {#                        <h5>Select Table To Merge: <span class="text-danger">*</span></h5>#}
    {#                        <div class="controls">#}
    {#                            <select name="tbl1" id="tbl1" class="form-control" onchange="populate('tbl1','tbl2')">#}
    {#                                <option value="" selected>--------</option>#}
    {#                                {% for t in table %}#}
    {#                                {% if t.reserved == 0 and t.merged == 0%}#}
    {#                                    <option value="{{t.id}}">{{t.title}}</option>#}
    {#                                {% endif %}#}
    {#                                {% endfor %}#}
    {#                            </select>#}
    {#                            <p id="msgSel1" class="text-danger"></p>#}
    {#                        </div>#}
    {#                        <br>#}
    {#                        <h5>Select Table To Merge with: <span class="text-danger">*</span></h5>#}
    {#                        <div class="controls">#}
    {#                            <select name="tbl2" id="tbl2" class="form-control">#}
    {#                            </select>#}
    {#                            <p id="msgSel2" class="text-danger"></p>#}
    {#                        </div>#}
    {#                    </div>#}
    {##}
    {#                    {{ form.as_p }}#}
    {#                    {% csrf_token %}#}
    {#                    <div class="form-group">#}
    {#                        <button type="submit" class="btn btn-danger btn-block waves-effect waves-light" onclick="return validateSel('tbl1','tbl2');"><i class="fa fa-handshake" ></i> Merge Table</button>#}
    {#                    </div>#}
    {#                </form>#}
    {#            </div>#}
    {#            <div class="modal-footer">#}
    {#                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>#}
    {#            </div>#}
    {#        </div>#}
    {#    </div>#}
    {#</div>#}
    <p><br><br></p> <p><br><br></p>

{% endblock %}

